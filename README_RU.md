# TMC5160 Stepper Stand

–¢–µ—Å—Ç–æ–≤—ã–π —Å—Ç–µ–Ω–¥ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —à–∞–≥–æ–≤—ã–º–∏ –¥–≤–∏–≥–∞—Ç–µ–ª—è–º–∏ –Ω–∞ –±–∞–∑–µ ESP32 –∏ –¥—Ä–∞–π–≤–µ—Ä–∞ TMC5160 —Å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º.

## üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ—Ç–æ—Ä–æ–º —á–µ—Ä–µ–∑ WiFi (—Ä–µ–∂–∏–º —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞)
- **–î—Ä–∞–π–≤–µ—Ä TMC5160** - –ü–æ–ª–Ω–æ–µ SPI —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ —Ä–µ–∂–∏–º–µ Motion Controller
- **–ö—Ä—É–≥–æ–≤–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø–æ–≤–æ—Ä–æ—Ç–∞ –Ω–∞ –∑–∞–¥–∞–Ω–Ω—ã–π —É–≥–æ–ª
- **–ü—Ä–µ—Å–µ—Ç—ã –º–æ—Ç–æ—Ä–æ–≤** - –ì–æ—Ç–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è NEMA 8/14/17/23
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏** - –ü–æ–∑–∏—Ü–∏—è, —Å–∫–æ—Ä–æ—Å—Ç—å, —Å—Ç–∞—Ç—É—Å
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ EEPROM** - –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –º–æ—Ç–æ—Ä–∞
- **–ü–µ—Ä–µ–¥–∞—Ç–æ—á–Ω–æ–µ —á–∏—Å–ª–æ** - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–µ–¥—É–∫—Ç–æ—Ä–æ–≤ –∏ —Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥–∞—á
- **–ú–æ–±–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** - –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ –∏ –¥–µ—Å–∫—Ç–æ–ø–∞

## üì± –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### –ö—Ä—É–≥–æ–≤–æ–µ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –£–≥–ª–∞–º–∏ (16 —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –ø–æ 22.5¬∞)
```
                  0¬∞
                  üîµ
                  
      -45¬∞               +45¬∞
       üü£                   üîµ
         
   -90¬∞ üü£‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄüîµ +90¬∞
         
       üü£                   üîµ
      -135¬∞             +135¬∞
      
                 üîµ
                ¬±180¬∞
```

- **–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —É–≥–ª—ã (+)** - –í—Ä–∞—â–µ–Ω–∏–µ –ø–æ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–µ
- **–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —É–≥–ª—ã (-)** - –í—Ä–∞—â–µ–Ω–∏–µ –ø—Ä–æ—Ç–∏–≤ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–∏
- **–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –¥–∏—Å–ø–ª–µ–π** - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é
- **–®–∞–≥ 22.5¬∞** - –¢–æ—á–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (16 —Å–µ–≥–º–µ–Ω—Ç–æ–≤)

## üõ†Ô∏è –ñ–µ–ª–µ–∑–æ

### –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- **ESP32 DevKit v1** (–∏–ª–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π)
- **–î—Ä–∞–π–≤–µ—Ä TMC5160** - **Mellow Fly 24V/48V HV TMC5160 Pro V1.5**
- **–®–∞–≥–æ–≤—ã–π –¥–≤–∏–≥–∞—Ç–µ–ª—å** (NEMA 8/14/17/23)
- **–ë–ª–æ–∫ –ø–∏—Ç–∞–Ω–∏—è** (24-48V –¥–ª—è TMC5160)

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (TMC5160 SPI –†–µ–∂–∏–º)
```
ESP32        TMC5160 Pro V1.5
-----        ---------------
GPIO23   ->  MOSI (SDI)
GPIO19   ->  MISO (SDO)
GPIO18   ->  SCK
GPIO5    ->  CS
GPIO21   ->  EN (Enable, –∞–∫—Ç–∏–≤–Ω—ã–π LOW)
GPIO4    ->  DIAG (StallGuard, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è sensorless homing)
GND      ->  GND
5V       ->  VCC_IO (–ª–æ–≥–∏–∫–∞ 3.3-5.5V)

VM       ->  24-48V (–ø–∏—Ç–∞–Ω–∏–µ –º–æ—Ç–æ—Ä–∞)
VSA      ->  12V (–¥–ª—è –∫—É–ª–µ—Ä–∞, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

**‚ö†Ô∏è –í–ê–ñ–ù–û:** 
- **–ü–ï–†–ï–†–ï–ñ–¨–¢–ï** –ø–µ—Ä–µ–º—ã—á–∫—É `SD_MODE` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ–Ω–∞ –ø–æ–¥—Ç—è–Ω—É—Ç–∞ –∫ VIO) - –¥—Ä–∞–π–≤–µ—Ä —Å–∞–º –ø–æ–¥—Ç—è–Ω–µ—Ç –∫ GND –¥–ª—è SPI —Ä–µ–∂–∏–º–∞!
- **DIAG –ø–∏–Ω (GPIO4)** - –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –¥–µ—Ç–µ–∫—Ü–∏–∏ StallGuard –∏ sensorless homing
- –î—Ä–∞–π–≤–µ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **24-48V** –≤—ã—Å–æ–∫–æ–≤–æ–ª—å—Ç–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –°—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PlatformIO
```bash
pip install platformio
```

### 2. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –°–±–æ—Ä–∫–∞
```bash
git clone https://github.com/yourusername/TMC5160-Test-Stand.git
cd TMC5160-Test-Stand
pio run -t upload        # –ü—Ä–æ—à–∏–≤–∫–∞ ESP32
pio run -t uploadfs      # –ó–∞–≥—Ä—É–∑–∫–∞ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
```

### 3. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WiFi
- **SSID:** `Krya`
- **–ü–∞—Ä–æ–ª—å:** `12345678`
- **IP –∞–¥—Ä–µ—Å:** `http://192.168.4.1`

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ú–æ—Ç–æ—Ä–∞ (src/config.h)
```cpp
#define TMC5160_RSENSE 0.033f      // –†–µ–∑–∏—Å—Ç–æ—Ä –∏–∑–º–µ—Ä–µ–Ω–∏—è —Ç–æ–∫–∞ (Œ©)
#define DEFAULT_CURRENT_MA 800     // –¢–æ–∫ –º–æ—Ç–æ—Ä–∞ (–º–ê)
#define DEFAULT_MICROSTEPS 16      // –ú–∏–∫—Ä–æ—à–∞–≥–∏
#define DEFAULT_MAX_SPEED 400      // –ú–∞–∫—Å. —Å–∫–æ—Ä–æ—Å—Ç—å (—à–∞–≥–æ–≤/—Å)
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ WiFi (src/config.h)
```cpp
#define WIFI_AP_SSID "Krya"
#define WIFI_AP_PASSWORD "12345678"
#define WIFI_AP_IP "192.168.4.1"
```

## üìä –ü—Ä–µ—Å–µ—Ç—ã –ú–æ—Ç–æ—Ä–æ–≤

| –ú–æ—Ç–æ—Ä | –¢–æ–∫ | Hold | –ú–∏–∫—Ä–æ—à–∞–≥–∏ | –°–∫–æ—Ä–æ—Å—Ç—å |
|-------|-----|------|-----------|----------|
| NEMA 8 | 600–º–ê | 30% | 32 | 300 —à–∞–≥/—Å |
| NEMA 14 | 700–º–ê | 40% | 16 | 350 —à–∞–≥/—Å |
| NEMA 17 | 800–º–ê | 50% | 16 | 400 —à–∞–≥/—Å |
| NEMA 23 | 2500–º–ê | 60% | 8 | 600 —à–∞–≥/—Å |

## üéÆ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤–æ–µ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
1. **–í–∫–ª—é—á–∏—Ç—å –º–æ—Ç–æ—Ä** - –ù–∞–∂–º–∏—Ç–µ "üîã –í–∫–ª—é—á–∏—Ç—å –º–æ—Ç–æ—Ä (HOLD)"
2. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã** - –°–∫–æ—Ä–æ—Å—Ç—å, —É—Å–∫–æ—Ä–µ–Ω–∏–µ, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤
3. **–î–≤–∏–∂–µ–Ω–∏–µ** - –ù–∞–∂–º–∏—Ç–µ "üöÄ –°—Ç–∞—Ä—Ç" –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ —É–≥–ª–æ–≤
4. **–û—Å—Ç–∞–Ω–æ–≤–∫–∞** - –ù–∞–∂–º–∏—Ç–µ "‚èπÔ∏è –°—Ç–æ–ø"

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –£–≥–ª–∞–º–∏
- –ù–∞–∂–º–∏—Ç–µ –ª—é–±—É—é –∫–Ω–æ–ø–∫—É —É–≥–ª–∞ (+22.5¬∞, +45¬∞, -90¬∞, –∏ —Ç.–¥.)
- –ú–æ—Ç–æ—Ä –ø–æ–≤–µ—Ä–Ω–µ—Ç—Å—è –Ω–∞ –∑–∞–¥–∞–Ω–Ω—ã–π —É–≥–æ–ª
- **+** = –ø–æ —á–∞—Å–æ–≤–æ–π, **-** = –ø—Ä–æ—Ç–∏–≤ —á–∞—Å–æ–≤–æ–π

### –ü–µ—Ä–µ–¥–∞—Ç–æ—á–Ω–æ–µ –ß–∏—Å–ª–æ
- –í–≤–µ–¥–∏—Ç–µ –ø–µ—Ä–µ–¥–∞—Ç–æ—á–Ω–æ–µ —á–∏—Å–ª–æ —Ä–µ–¥—É–∫—Ç–æ—Ä–∞/—Ä–µ–º–Ω—è
- **1.0** = –ø—Ä—è–º–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ (–±–µ–∑ —Ä–µ–¥—É–∫—Ç–æ—Ä–∞)
- **3.0** = —Ä–µ–¥—É–∫—Ç–æ—Ä 1:3 (–º–æ—Ç–æ—Ä 3 –æ–±–æ—Ä–æ—Ç–∞ ‚Üí –≤–∞–ª 1 –æ–±–æ—Ä–æ—Ç)
- **0.333** = –æ–±—Ä–∞—Ç–Ω—ã–π —Ä–µ–¥—É–∫—Ç–æ—Ä 3:1 (–º–æ—Ç–æ—Ä 1 –æ–±–æ—Ä–æ—Ç ‚Üí –≤–∞–ª 3 –æ–±–æ—Ä–æ—Ç–∞)

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ù–∞—Å—Ç—Ä–æ–µ–∫
- –ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø—Ä–µ—Å–µ—Ç: "üìã –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–µ—Å–µ—Ç"
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—Ä—É—á–Ω—É—é
- –ù–∞–∂–º–∏—Ç–µ "üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"

## üîß API Endpoints

| Endpoint | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-------|----------|
| `/api/status` | GET | –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å –º–æ—Ç–æ—Ä–∞ |
| `/api/move` | POST | –î–≤–∏–∂–µ–Ω–∏–µ –º–æ—Ç–æ—Ä–∞ (—à–∞–≥–∏) |
| `/api/enable` | POST | –í–∫–ª—é—á–∏—Ç—å –º–æ—Ç–æ—Ä |
| `/api/disable` | POST | –í—ã–∫–ª—é—á–∏—Ç—å –º–æ—Ç–æ—Ä |
| `/api/stop` | POST | –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ |
| `/api/reset` | POST | –°–±—Ä–æ—Å –ø–æ–∑–∏—Ü–∏–∏ |
| `/api/save_settings` | POST | –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ EEPROM |
| `/api/save_gear_ratio` | POST | –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–µ—Ä–µ–¥–∞—Ç–æ—á–Ω–æ–µ —á–∏—Å–ª–æ |

## üîç –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ TMC5160 Pro V1.5

- **–ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ:** 24-48V (–≤—ã—Å–æ–∫–æ–≤–æ–ª—å—Ç–Ω—ã–π)
- **–¢–æ–∫:** –¥–æ 3A RMS –Ω–∞ —Ñ–∞–∑—É
- **SPI —Å–∫–æ—Ä–æ—Å—Ç—å:** 100 kHz (—Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞)
- **–†–µ–∂–∏–º:** Motion Controller (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —à–∞–≥–æ–≤)
- **SpreadCycle** - –¢–∏—Ö–∞—è –∏ —Ç–æ—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞
- **StallGuard4** - –î–µ—Ç–µ–∫—Ü–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ –∏ sensorless homing (—á–µ—Ä–µ–∑ DIAG –ø–∏–Ω)

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - —Å–≤–æ–±–æ–¥–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–π—Ç–µ!

## üôè –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏

- **TMC5160 Library** - [tommag/TMC5160_Arduino](https://github.com/tommag/TMC5160_Arduino)
- **ESPAsyncWebServer** - [ESP32Async](https://github.com/ESP32Async/ESPAsyncWebServer)
- **ArduinoJson** - [bblanchon](https://github.com/bblanchon/ArduinoJson)

## üìß –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø—Ä–æ–±–ª–µ–º –æ—Ç–∫—Ä—ã–≤–∞–π—Ç–µ Issue –Ω–∞ GitHub.

---

**–°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —à–∞–≥–æ–≤—ã—Ö –¥–≤–∏–≥–∞—Ç–µ–ª–µ–π**

[üá¨üáß English Documentation](README.md)

